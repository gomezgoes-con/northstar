<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NorthStar - Query Analyzer for StarRocks</title>
  
  <!-- Google Font: JetBrains Mono for that data/code feel -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- ========================================
       Header Section
       ======================================== -->
  <header>
    <img src="northstar.png" alt="NorthStar Logo" class="logo-img">
    <div class="logo">NorthStar</div>
    <h1>Query Analyzer for StarRocks</h1>
  </header>

  <!-- ========================================
       Tab Navigation
       ======================================== -->
  <nav class="tab-nav">
    <button class="tab-btn active" data-tab="single">Scan Summary</button>
    <button class="tab-btn" data-tab="join">Join Summary</button>
    <button class="tab-btn" data-tab="compare">Query Comparison</button>
    <button class="tab-btn" data-tab="plan">Query Plan</button>
  </nav>

  <!-- ========================================
       Main Content
       ======================================== -->
  <main>
    <!-- ====== SINGLE QUERY TAB ====== -->
    <div class="tab-panel active" id="tab-single">
      <!-- Drop Zone: Visible initially for file upload -->
      <div class="drop-zone" id="dropZone">
      <div class="drop-zone-icon">üìÅ</div>
      <h2>Drop your query profile JSON here</h2>
      <p>or click to browse files</p>
      <input type="file" id="fileInput" accept=".json">
    </div>

    <!-- Dashboard: Hidden until a file is loaded -->
    <div class="dashboard" id="dashboard">
      
      <!-- Query Info Panel -->
      <section class="query-info">
        <h2>Query Information</h2>
        <div class="query-meta" id="queryMeta">
          <!-- Populated by JavaScript -->
        </div>
      </section>

      <!-- Summary Cards - Organized in Sections -->
      <div class="cards-container">
        <section class="cards-section" id="memoryCards">
          <h3 class="section-title">Memory</h3>
          <div class="summary-cards">
            <!-- Populated by JavaScript -->
          </div>
        </section>
        
        <section class="cards-section" id="timeCards">
          <h3 class="section-title">Time</h3>
          <div class="summary-cards">
            <!-- Populated by JavaScript -->
          </div>
        </section>
        
        <section class="cards-section" id="scanCards">
          <h3 class="section-title">Scan Metrics</h3>
          <div class="summary-cards">
            <!-- Populated by JavaScript -->
          </div>
        </section>
      </div>

      <!-- CONNECTOR_SCAN Table -->
      <section class="table-section">
        <div class="table-header">
          <h2>üîç CONNECTOR_SCAN Operators</h2>
        </div>
        <div class="table-container">
          <table id="scanTable">
            <thead id="tableHead">
              <!-- Populated by JavaScript: two rows (group headers + column headers) -->
            </thead>
            <tbody id="tableBody">
              <!-- Populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </section>
    </div>
    </div> <!-- End of tab-single -->

    <!-- ====== JOIN SUMMARY TAB ====== -->
    <div class="tab-panel" id="tab-join">
      <!-- Drop Zone: Visible initially for file upload -->
      <div class="drop-zone" id="joinDropZone">
        <div class="drop-zone-icon">üîó</div>
        <h2>Drop your query profile JSON here</h2>
        <p>or click to browse files</p>
        <input type="file" id="joinFileInput" accept=".json">
      </div>

      <!-- Dashboard: Hidden until a file is loaded -->
      <div class="dashboard" id="joinDashboard">

        <!-- Query Info Panel -->
        <section class="query-info">
          <h2>Query Information</h2>
          <div class="query-meta" id="joinQueryMeta">
            <!-- Populated by JavaScript -->
          </div>
        </section>

        <!-- Summary Cards -->
        <div class="cards-container">
          <section class="cards-section" id="joinMemoryCards">
            <h3 class="section-title">Join Memory</h3>
            <div class="summary-cards">
              <!-- Populated by JavaScript -->
            </div>
          </section>

          <section class="cards-section" id="joinTimeCards">
            <h3 class="section-title">Join Time</h3>
            <div class="summary-cards">
              <!-- Populated by JavaScript -->
            </div>
          </section>
        </div>

        <!-- HASH_JOIN Table -->
        <section class="table-section">
          <div class="table-header">
            <h2>üîó HASH_JOIN Operators</h2>
          </div>
          <div class="table-container">
            <table id="joinTable">
              <thead id="joinTableHead">
                <!-- Populated by JavaScript: group headers + column headers -->
              </thead>
              <tbody id="joinTableBody">
                <!-- Populated by JavaScript -->
              </tbody>
            </table>
          </div>
        </section>
      </div>
    </div> <!-- End of tab-join -->

    <!-- ====== QUERY COMPARISON TAB ====== -->
    <div class="tab-panel" id="tab-compare">
      <!-- Two Drop Zones for Comparison -->
      <div class="compare-dropzones">
        <div class="compare-drop baseline" id="compareDropBaseline">
          <h3>üìä Baseline Query</h3>
          <p>Drop the original query profile</p>
          <input type="file" id="compareFileBaseline" accept=".json">
        </div>
        <div class="compare-drop optimized" id="compareDropOptimized">
          <h3>üöÄ Optimized Query</h3>
          <p>Drop the optimized query profile</p>
          <input type="file" id="compareFileOptimized" accept=".json">
        </div>
      </div>

      <!-- Comparison Results (hidden until both files loaded) -->
      <div class="compare-results" id="compareResults">
        <!-- Query Info Headers -->
        <div class="compare-header">
          <div class="compare-query-info baseline">
            <h4>üìä Baseline</h4>
            <div class="meta-row" id="compareMetaBaseline"></div>
          </div>
          <div class="compare-query-info optimized">
            <h4>üöÄ Optimized</h4>
            <div class="meta-row" id="compareMetaOptimized"></div>
          </div>
        </div>

        <!-- Memory Comparison -->
        <div class="compare-cards-section">
          <h3>Memory Comparison</h3>
          <div class="compare-cards-grid" id="compareMemoryCards"></div>
        </div>

        <!-- Time Comparison -->
        <div class="compare-cards-section">
          <h3>Time Comparison</h3>
          <div class="compare-cards-grid" id="compareTimeCards"></div>
        </div>

        <!-- Scan Metrics Comparison -->
        <div class="compare-cards-section">
          <h3>Scan Metrics Comparison</h3>
          <div class="compare-cards-grid" id="compareScanCards"></div>
        </div>

        <!-- Join Metrics Comparison -->
        <div class="compare-cards-section">
          <h3>Join Metrics Comparison</h3>
          <div class="compare-cards-grid" id="compareJoinCards"></div>
        </div>
      </div>
    </div>

    <!-- ====== QUERY PLAN TAB ====== -->
    <div class="tab-panel" id="tab-plan">
      <!-- Drop Zone for Plan -->
      <div class="drop-zone" id="planDropZone">
        <div class="drop-zone-icon">üó∫Ô∏è</div>
        <h3>Drop Query Profile JSON</h3>
        <p>Drag & drop a profile to visualize the execution plan</p>
        <input type="file" id="planFileInput" accept=".json">
      </div>

      <!-- Plan Visualization Container (hidden until file loaded) -->
      <div class="plan-container" id="planContainer" style="display: none;">
        <div class="plan-header">
          <h3>Execution Plan</h3>
          <button class="btn-reset" id="planReset">Load Different Profile</button>
        </div>
        <div class="plan-canvas" id="planCanvas">
          <!-- Tree will be rendered here -->
        </div>
      </div>
    </div>
  </main>

  <!-- ========================================
       JavaScript Modules
       ======================================== -->
  <script type="module" src="js/main.js"></script>

  <!-- Privacy-respecting analytics (no cookies, no consent popup) -->
  <script data-goatcounter="https://northstar.goatcounter.com/count"
          async src="//gc.zgo.at/count.js"></script>
</body>
</html>
